# Minecraft Modpack AI 시스템 요구사항 명세서 (NeoForge 모드 버전)

## 📋 프로젝트 개요

### 목적
- **VM 환경에서 다중 모드팩 서버 관리**: 20개 이상의 Minecraft 모드팩 서버를 단일 VM에서 효율적으로 관리
- **AI 기반 모드팩 지원**: 각 모드팩별 맞춤형 AI 어시스턴트 제공
- **통합 관리 시스템**: 모드팩 전환, 설정 관리, 모니터링을 위한 통합 솔루션
- **플레이어 동기부여 시스템**: AI 아이템을 통한 모드팩 적응 및 흥미 유발
- **GCP VM 환경 최적화**: Google Cloud Platform Debian 환경에서의 안정적인 운영
- **NeoForge 네이티브 지원**: 하이브리드 서버 없이 순수 NeoForge 서버에서 작동

### 핵심 가치
- **자동화**: 수동 작업 최소화
- **확장성**: 새로운 모드팩 추가 용이
- **안정성**: 서버 안정성 및 백업 보장
- **사용자 친화성**: 직관적인 인터페이스
- **게임성**: 플레이어의 모드팩 적응을 돕는 재미있는 요소
- **API 호환성**: 최신 라이브러리와의 안정적인 호환성 보장
- **NeoForge 네이티브**: 순수 NeoForge 모드로 구현되어 안정성 극대화
- **서버스타터 호환성**: 기존 모드팩 서버스타터와의 완벽 통합

---

## 🏗️ 시스템 아키텍처

### 전체 구조
```
VM (Ubuntu 22.04 LTS / Debian)
├── minecraft-modpack-ai/          # 메인 프로젝트
│   ├── minecraft_mod/             # NeoForge 모드 (메인)
│   ├── minecraft_plugin/          # Bukkit 플러그인 (레거시)
│   ├── backend/                   # Python 백엔드 (Flask)
│   ├── config/                    # 설정 파일
│   ├── guides/                    # 사용자 가이드
│   └── scripts/                   # 관리 스크립트
├── [모드팩1]/                     # atm10, enigmatica_10 등
│   ├── mods/                      # 모드 디렉토리 (modpackai-*.jar)
│   ├── config/                    # 설정 디렉토리 (modpackai-config.json)
│   └── logs/                      # 로그 디렉토리
├── [모드팩2]/
└── [모드팩N]/
```

### 컴포넌트별 역할
1. **NeoForge 모드**: Minecraft 내 게임 인터페이스 (메인)
2. **Python 백엔드**: AI 처리 및 모드팩 분석 (Flask 기반)
3. **관리 스크립트**: 서버 관리 자동화
4. **데이터베이스**: 채팅 기록 및 설정 저장 (SQLite)
5. **RAG 시스템**: Google Cloud Storage + FAISS 기반 지식 검색
6. **Bukkit 플러그인**: 레거시 지원 (하이브리드 서버 필요)

---

## 🎯 핵심 요구사항

### 1. 모드팩 관리 시스템

#### 1.1 모드팩 감지 및 등록
- **자동 감지**: VM 내 모든 모드팩 디렉토리 자동 스캔
- **패턴 인식**: 다양한 모드팩 명명 패턴 지원
  - `atm10`, `enigmatica_10`, `beyond_depth` 등
  - 서버 압축파일명에서 정보 추출 (예: `Enigmatica6Server-1.11.0.zip`)
- **수동 등록**: 자동 감지 실패 시 수동 입력 지원
- **모드팩 분석**: ZIP/JAR 파일 파싱을 통한 모드, 레시피, 아이템 정보 추출
- **GCP VM 환경 최적화**: Debian 기반 VM에서의 안정적인 모드팩 관리

#### 1.2 모드팩 전환 시스템
- **원클릭 전환**: `/modpack switch [모드팩명]` 명령어
- **안전 전환**: 
  - 현재 서버 정상 종료
  - 새 모드팩 서버 시작
  - 상태 확인 및 복구
- **전환 기록**: 모드팩 전환 이력 관리
- **NeoForge 네이티브**: 순수 NeoForge 서버에서 안정적 작동

#### 1.3 모드 설치 자동화
- **자동 설치**: `install_mod.sh` 스크립트로 모든 모드팩에 자동 설치
- **Gradle 빌드**: NeoForge 모드 자동 빌드 및 배포
- **설정 파일 생성**: 모드팩별 맞춤 설정 파일 자동 생성
- **권한 설정**: 실행 권한 자동 부여
- **서버스타터 호환성**: 기존 모드팩 서버스타터와의 완벽 통합

### 2. AI 시스템

#### 2.1 모드팩별 AI 어시스턴트
- **맞춤형 응답**: 각 모드팩의 모드, 아이템, 레시피 정보 기반
- **다중 AI 모델**: Gemini 2.5 Pro (메인), GPT-4o-mini, Claude 3.5 Sonnet 지원
- **Gemini 2.5 Pro 우선**: 웹검색 기능을 지원하는 Gemini 2.5 Pro를 기본 모델로 설정
- **실시간 전환**: 모드팩 변경 시 AI 모델 자동 전환
- **조건부 초기화**: API 키가 없는 모델은 자동 제외하여 안정성 보장
- **간소화된 아키텍처**: 복잡한 모듈 구조에서 단일 Flask 앱으로 단순화

#### 2.2 웹검색 시스템 (Gemini 2.5 Pro)
- **실시간 웹검색**: Gemini 2.5 Pro의 Google Search 기능 활용
- **최신 정보 제공**: 마인크래프트 모드팩의 최신 정보 및 업데이트 제공
- **자동 폴백**: 웹검색 실패 시 기본 AI 모델로 자동 전환
- **google-genai SDK**: 최신 Google Generative AI SDK 사용
- **Tool 기반 검색**: `types.Tool(google_search=types.GoogleSearch())` 활용

#### 2.3 API 엔드포인트 간소화
- **단순화된 경로**: `/api/` 접두사 제거하여 `/chat`, `/models`, `/recipe`, `/health` 사용
- **직접 AI 호출**: 복잡한 매니저 구조 없이 Flask 앱에서 직접 AI 모델 호출
- **성능 향상**: 응답 시간 1-3초로 단축 (기존 3-6초에서 개선)
- **메모리 최적화**: 단일 앱 구조로 메모리 사용량 감소

#### 2.4 언어 처리 시스템
- **4단계 하이브리드 번역**: 한국어-영어 아이템명 매핑
  1. 커스텀 데이터베이스 검색
  2. 일반 번역 데이터베이스 검색
  3. 부분 매칭 검색
  4. AI 번역 (최후 수단)
- **한국어 질문 지원**: 한국어로 질문하여 영어 모드팩 정보 검색

#### 2.5 레시피 및 아이템 지원
- **레시피 검색**: 아이템명으로 제작법 조회
- **3x3 크래프팅**: 시각적 레시피 표시
- **모드팩별 데이터**: 각 모드팩의 고유 아이템/레시피 지원

#### 2.6 채팅 시스템
- **Screen GUI 인터페이스**: Minecraft 내 Screen API 기반 채팅 GUI
- **직접 명령어**: `/ai <질문>` 명령어로 즉시 질문
- **대화 기록**: 채팅 히스토리 저장 및 관리
- **멀티플레이어**: 여러 플레이어 동시 지원

### 3. AI 아이템 시스템 (신규)

#### 3.1 AI 아이템 획득
- **관리자 지급**: `/modpackai give` 명령어로 관리자가 지급
- **크래프팅 시스템**: 모드팩 적응을 위한 조합법 제공
- **업그레이드 경로**: 기본 → 고급 → 최고급 AI 아이템

#### 3.2 AI 아이템 기능
- **기본 기능**: AI 질문 및 답변
- **특수 기능**: 텔레포트, 아이템 복사, 날씨 변경 등
- **충전 시스템**: 사용 횟수 제한 및 재충전 메커니즘
- **성취 시스템**: AI 아이템 사용을 통한 성취 달성

#### 3.3 동기부여 시스템
- **난이도별 조합법**: 모드팩 적응도를 고려한 재료 난이도
- **리스크-리워드**: 도박성 요소를 통한 흥미 유발
- **퀘스트 시스템**: AI 아이템 관련 퀘스트 제공
- **업그레이드 메리트**: 단계별 기능 향상

### 4. 서버 관리 및 모니터링

#### 4.1 자동화 스크립트
- **서버 시작/종료**: 자동화된 서버 관리
- **상태 모니터링**: 서버 상태 실시간 감시
- **백업 시스템**: 자동 백업 및 복구
- **GCP Debian 호환**: Google Cloud Platform Debian 환경 최적화
- **NeoForge 서버 관리**: 순수 NeoForge 서버 환경 관리

#### 4.2 설정 관리
- **중앙 집중식**: 모든 모드팩 설정 통합 관리
- **템플릿 시스템**: 공통 설정 템플릿 제공
- **버전 관리**: 설정 변경 이력 추적
- **환경 변수**: Config 클래스를 통한 설정 관리

### 5. 사용자 인터페이스

#### 5.1 Minecraft NeoForge 모드 GUI
- **AI 채팅**: `/ai` 명령어로 AI와 대화
- **모델 선택**: AI 모델 변경 GUI
- **레시피 뷰어**: 3x3 크래프팅 테이블 시각화
- **직관적 UX**: 아이템 우클릭으로 GUI 열기
- **Screen API 기반**: 현대적이고 유연한 GUI 시스템

#### 5.2 관리자 도구
- **웹 대시보드**: 서버 상태 및 관리 인터페이스
- **로그 뷰어**: 실시간 로그 모니터링
- **설정 편집기**: 모드팩별 설정 편집

### 6. 테스트 시스템 (신규)

#### 6.1 테스트 구조
- **pytest 기반**: Python 테스트 프레임워크
- **단위 테스트**: 개별 컴포넌트 테스트
- **통합 테스트**: 전체 시스템 통합 테스트
- **커버리지**: 코드 커버리지 측정 및 리포트

#### 6.2 테스트 관리
- **pytest.ini**: 테스트 설정 및 마커 정의
- **run_tests.py**: 테스트 실행 스크립트
- **conftest.py**: 공통 테스트 픽스처
- **테스트 가이드**: 상세한 테스트 실행 방법 문서

### 7. API 호환성 및 의존성 관리 (신규)

#### 7.1 라이브러리 버전 관리
- **최신 API 지원**: Google Generative AI, OpenAI, Anthropic 최신 버전 지원
- **조건부 기능**: API 키가 없는 기능은 자동 비활성화
- **안정적 폴백**: 고급 기능 실패 시 기본 기능으로 자동 전환
- **의존성 충돌 해결**: 라이브러리 버전 충돌 시 자동 해결
- **google-genai SDK**: 최신 Google Generative AI SDK (0.3.0+) 사용

#### 7.2 백엔드 안정성
- **오류 처리**: 모든 API 호출에 대한 예외 처리
- **서비스 복구**: 백엔드 서비스 자동 재시작
- **상태 모니터링**: 실시간 서비스 상태 확인
- **로그 관리**: 상세한 오류 로그 및 디버깅 정보
- **간소화된 구조**: 복잡한 모듈 의존성 제거로 안정성 향상

#### 7.3 모드 빌드 안정성
- **Gradle 의존성**: 필수 라이브러리 자동 설치
- **컴파일 오류 해결**: Java 컴파일 오류 자동 수정
- **API 호환성**: NeoForge API 버전 호환성 보장
- **빌드 자동화**: 모드 빌드 프로세스 자동화

### 8. GCP VM 업그레이드 시스템 (신규)

#### 8.1 자동 업그레이드 스크립트
- **원클릭 업그레이드**: `upgrade.sh` 스크립트로 자동 업그레이드
- **백업 자동화**: 업그레이드 전 자동 백업 생성
- **환경 변수 보존**: 기존 API 키 및 설정 자동 복원
- **서비스 재시작**: 업그레이드 후 자동 서비스 재시작

#### 8.2 업그레이드 검증
- **API 테스트**: 업그레이드 후 자동 API 기능 테스트
- **상태 확인**: 서비스 상태 및 로그 자동 확인
- **롤백 기능**: 문제 발생 시 이전 버전으로 자동 복원
- **진행 상황 표시**: 실시간 업그레이드 진행 상황 표시

#### 8.3 호환성 보장
- **기존 데이터 보존**: 채팅 기록, 설정 등 기존 데이터 보존
- **API 호환성**: 기존 Minecraft 모드와의 호환성 유지
- **점진적 업그레이드**: 단계별 업그레이드로 안정성 보장

### 9. NeoForge 모드 시스템 (신규)

#### 9.1 모드 아키텍처
- **@Mod 어노테이션**: NeoForge 모드 표준 구조
- **Brigadier 명령어**: 현대적인 명령어 시스템
- **Screen API**: 유연한 GUI 시스템
- **@SubscribeEvent**: 이벤트 기반 프로그래밍
- **JSON 설정**: 구조화된 설정 관리

#### 9.2 모드 빌드 시스템
- **Gradle 빌드**: 표준 NeoForge 모드 빌드 시스템
- **자동 의존성 관리**: Maven Central에서 의존성 자동 해결
- **JAR 패키징**: 실행 가능한 모드 JAR 자동 생성
- **버전 관리**: Semantic Versioning 기반 버전 관리

#### 9.3 모드 배포 시스템
- **자동 설치**: 모든 모드팩에 자동 모드 설치
- **설정 파일 생성**: 모드팩별 맞춤 설정 자동 생성
- **호환성 검증**: NeoForge 버전 호환성 자동 확인
- **롤백 지원**: 문제 발생 시 이전 버전으로 복원

### 10. 레거시 플러그인 지원 (신규)

#### 10.1 플러그인 호환성
- **Bukkit 플러그인**: 하이브리드 서버에서 사용 가능
- **API 매핑**: 플러그인과 모드 간 API 호환성
- **설정 변환**: 플러그인 설정을 모드 설정으로 변환
- **단계적 마이그레이션**: 플러그인에서 모드로 점진적 전환

#### 10.2 하이브리드 서버 지원
- **Arclight**: NeoForge + Bukkit 하이브리드 서버
- **Mohist**: Forge + Bukkit 하이브리드 서버
- **CardBoard**: Fabric + Bukkit 하이브리드 서버
- **자동 감지**: 서버 타입에 따른 적절한 설치 방식 선택

---

## 🔧 기술적 요구사항

### 1. 개발 환경
- **OS**: Ubuntu 22.04 LTS / Debian (GCP VM)
- **Java**: OpenJDK 17+ (NeoForge 모드용)
- **Python**: 3.9+ (백엔드용)
- **Minecraft**: 1.21.1 (NeoForge)
- **Gradle**: 8.0+ (모드 빌드용)

### 2. 의존성 관리
- **Gradle**: NeoForge 모드 빌드 (의존성 자동 해결)
- **pip**: Python 패키지 관리 (requirements.txt)
- **google-genai**: 최신 Google Generative AI SDK (0.3.0+)
- **flask**: 웹 프레임워크 (간소화된 구조)
- **Docker**: 컨테이너화 (선택사항)
- **버전 호환성**: 라이브러리 버전 충돌 자동 해결

### 3. 데이터베이스
- **SQLite**: 로컬 데이터 저장
- **JSON**: 설정 및 캐시 데이터
- **파일 시스템**: 모드팩 데이터 저장

### 4. 네트워크
- **HTTP API**: 백엔드 통신 (Flask) - 간소화된 엔드포인트
- **API 경로**: `/chat`, `/models`, `/recipe`, `/health` (단순화)
- **포트 관리**: 동적 포트 할당
- **CORS**: 크로스 오리진 요청 지원
- **실시간 통신**: HTTP 기반 실시간 응답

### 5. 보안
- **Rate Limiting**: API 요청 제한
- **입력 검증**: UUID, 메시지 길이, XSS/SQLi 방지
- **인증**: 플레이어 UUID 기반 인증

### 6. API 키 관리 (신규)
- **환경 변수**: .env 파일을 통한 안전한 API 키 관리
- **조건부 초기화**: API 키가 없는 서비스 자동 비활성화
- **키 검증**: API 키 유효성 검증
- **폴백 메커니즘**: 주요 API 실패 시 대체 서비스 사용

### 7. NeoForge 모드 기술 요구사항 (신규)
- **NeoForge 21.1.184**: 최신 NeoForge API 사용
- **Minecraft 1.21.1**: 최신 Minecraft 버전 지원
- **Gradle 8.0+**: 모던 빌드 시스템
- **Java 17+**: 최신 Java 버전 지원
- **JAR 파일 검증**: 모드 JAR 파일 크기 및 무결성 검증

---

## 🚨 현재 문제점 및 해결 방안

### 1. Git 인증 문제
- **문제점**: GitHub 인증 실패로 프로젝트 클론 불가
- **해결 방안**: SSH 키 설정 또는 Personal Access Token 사용

### 2. 디렉토리 구조 호환성
- **문제점**: VM의 실제 디렉토리 구조와 프로젝트 구조 불일치
- **해결 방안**: 설치 스크립트를 통한 자동 구조 매핑

### 3. AI 아이템 획득 방법
- **문제점**: 플레이어가 AI 아이템을 얻을 방법이 명확하지 않음
- **해결 방안**: 관리자 명령어 및 크래프팅 시스템 구현

### 4. API 호환성 문제 (신규)
- **문제점**: Google Vertex AI, Hugging Face Hub 등 라이브러리 버전 충돌
- **해결 방안**: 조건부 초기화 및 최신 API 사용으로 자동 해결

### 5. 백엔드 안정성 (신규)
- **문제점**: 의존성 문제로 백엔드 서비스 시작 실패
- **해결 방안**: 가상환경 재생성 및 최신 라이브러리 사용

### 6. 모드 빌드 문제 (신규)
- **문제점**: Gradle 빌드 실패 또는 의존성 문제
- **해결 방안**: 
  - Gradle 자동 설치 및 버전 관리
  - 의존성 충돌 자동 해결
  - 빌드 캐시 정리 기능

### 7. 모드 로드 문제 (신규)
- **문제점**: NeoForge 서버에서 모드 로드 실패
- **해결 방안**: 
  - NeoForge 버전 호환성 자동 확인
  - 모드 파일 무결성 검증
  - 로그 분석 및 디버깅 도구

### 8. UUID 검증 문제 (신규)
- **문제점**: API 테스트 시 UUID 형식 오류
- **해결 방안**: UUID 검증 로직 완화 (테스트용 간단한 문자열 허용)

---

## 📋 구현 우선순위

### Phase 1: 기본 인프라 (높음)
1. Git 인증 문제 해결
2. 간소화된 AI 백엔드 구축 (Flask) - Gemini 2.5 Pro 우선
3. 모드팩 감지 시스템 구현
4. Gemini 2.5 Pro 웹검색 시스템 구축
5. NeoForge 모드 빌드 시스템 구축

### Phase 2: 핵심 기능 (높음)
1. AI 채팅 시스템 (`/ai` 명령어) - Gemini 2.5 Pro 웹검색 적용
2. 모드팩 전환 기능
3. 레시피 검색 시스템
4. 언어 매핑 시스템
5. API 엔드포인트 간소화
6. NeoForge 모드 GUI 시스템

### Phase 3: 모드 시스템 최적화 (중간)
1. NeoForge 모드 자동 빌드 및 배포
2. 모드 설정 시스템 고도화
3. Screen API 기반 GUI 완성
4. 이벤트 시스템 최적화

### Phase 4: AI 아이템 시스템 (중간)
1. AI 아이템 기본 기능
2. 크래프팅 및 업그레이드 시스템
3. 특수 기능 구현
4. 동기부여 시스템

### Phase 5: 고급 기능 (중간)
1. 웹 대시보드
2. 고급 모니터링
3. 백업 시스템
4. 테스트 시스템 완성
5. GCP VM 자동 업그레이드 시스템

### Phase 6: 최적화 (낮음)
1. 성능 최적화 (간소화된 구조 활용)
2. UI/UX 개선
3. 추가 AI 모델 지원
4. 웹 검색 기능 강화 (Gemini 2.5 Pro 기반)
5. 업그레이드 스크립트 고도화

---

## 🎯 성공 기준

### 기능적 기준
- [ ] 20개 모드팩 자동 감지 및 등록
- [ ] 5초 이내 모드팩 전환
- [ ] AI 응답 시간 1-3초 이내 (간소화로 개선)
- [ ] 99% 서버 가동률
- [ ] 한국어-영어 아이템명 매핑 정확도 95% 이상
- [ ] API 키 없는 서비스 자동 비활성화
- [ ] Gemini 2.5 Pro 웹검색 기능 정상 작동
- [ ] GCP VM 자동 업그레이드 성공률 95% 이상
- [ ] NeoForge 모드 빌드 성공률 95% 이상
- [ ] 모드 자동 설치 성공률 90% 이상

### 기술적 기준
- [ ] 모든 Java 컴파일 오류 해결
- [ ] Python 백엔드 정상 작동 (Flask - 간소화된 구조)
- [ ] Gemini 2.5 Pro 웹검색 시스템 정상 작동
- [ ] 데이터베이스 연결 안정성
- [ ] 메모리 사용량 최적화 (간소화로 30% 감소)
- [ ] 테스트 커버리지 80% 이상
- [ ] 라이브러리 버전 충돌 자동 해결
- [ ] 백엔드 서비스 자동 복구
- [ ] google-genai SDK 정상 작동
- [ ] API 엔드포인트 간소화 완료
- [ ] NeoForge 모드 정상 작동
- [ ] Gradle 빌드 시스템 완성

### 사용자 경험 기준
- [ ] 직관적인 GUI 인터페이스
- [ ] 명확한 오류 메시지 (한국어)
- [ ] 빠른 응답 시간 (1-3초)
- [ ] 안정적인 서버 운영
- [ ] AI 아이템을 통한 모드팩 적응 지원
- [ ] API 키 설정 없이도 기본 기능 사용 가능
- [ ] Gemini 2.5 Pro 웹검색으로 최신 정보 제공
- [ ] 간소화된 API로 빠른 응답
- [ ] GCP VM 원클릭 업그레이드 지원
- [ ] NeoForge 모드 원클릭 설치
- [ ] Screen API 기반 현대적 GUI

---

## 📚 참고 자료

### 문서
- `guides/01_ADMIN_SETUP.md`: 관리자 설정 가이드 (모드 버전)
- `guides/02_SYSTEM_OVERVIEW.md`: 시스템 개요 (모드 기반)
- `guides/03_GAME_COMMANDS.md`: 게임 내 명령어 가이드
- `guides/04_MODPACK_SWITCH.md`: 모드팩 전환 가이드
- `guides/05_DEVELOPMENT.md`: 개발자 가이드
- `README.md`: 프로젝트 개요 (모드 버전)

### 코드 구조
- `minecraft_mod/`: NeoForge 모드 소스 (메인)
- `minecraft_plugin/`: Bukkit 플러그인 소스 (레거시)
- `backend/`: Python 백엔드 (Flask)
- `config/`: 설정 파일
- `scripts/`: 관리 스크립트

### 설정 파일
- `build.gradle`: Gradle 의존성 (모드 빌드용)
- `pom.xml`: Maven 의존성 (플러그인 빌드용)
- `requirements.txt`: Python 패키지
- `modpackai-config.json`: 모드 설정
- `pytest.ini`: 테스트 설정

---

## 🔄 업데이트 이력

| 날짜 | 버전 | 변경사항 | 작성자 |
|------|------|----------|--------|
| 2024-01-XX | 1.0 | 초기 요구사항 명세 | System |
| 2024-01-XX | 1.1 | AI 아이템 시스템 추가 | System |
| 2024-01-XX | 1.2 | RAG 시스템 및 언어 처리 추가 | System |
| 2024-01-XX | 1.3 | 테스트 시스템 및 보안 요구사항 추가 | System |
| 2025-08-06 | 1.4 | API 호환성 및 의존성 관리 요구사항 추가 | System |
| 2025-01-XX | 2.0 | Gemini 2.5 Pro 웹검색, 백엔드 간소화, GCP VM 업그레이드 시스템 추가 | System |
| 2025-08-08 | 2.1 | 하이브리드 서버 지원, 서버스타터 호환성, NeoForge 모드 변환 시스템 추가 | System |
| 2025-08-08 | 3.0 | NeoForge 모드 중심으로 완전 전환, 플러그인을 레거시로 변경 | System |

---

**문서 버전**: 3.0  
**최종 업데이트**: 2025년 8월 8일  
**담당자**: AI Assistant  
**상태**: 검토 완료 